<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Mapa de Criticidad â€” ARA</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="css/app.css"/>
</head>
<body>

<nav>
  <div style="display:flex;align-items:center">
    <div class="nav-brand">ARA</div>
    <div class="nav-sub">Mapa de Criticidad &nbsp;Â·&nbsp; <strong id="navInfo">Cargando...</strong></div>
  </div>
  <div style="display:flex;align-items:center;gap:12px">
    <div class="year-btns">
      <span class="yl">AÃ±o:</span>
      <button class="yb" data-y="2024" onclick="setYear(2024)">2024</button>
      <button class="yb" data-y="2025" onclick="setYear(2025)">2025</button>
      <button class="yb active" data-y="2026" onclick="setYear(2026)">2026</button>
    </div>
    <select id="fmes" onchange="setMes(parseInt(this.value))" style="border:1px solid #ddd;border-radius:6px;padding:4px 8px;font-size:12px;color:#555;background:#fff;cursor:pointer">
      <option value="0">Todos los meses</option>
      <option value="1">Ene</option><option value="2">Feb</option><option value="3">Mar</option>
      <option value="4">Abr</option><option value="5">May</option><option value="6">Jun</option>
      <option value="7">Jul</option><option value="8">Ago</option><option value="9">Sep</option>
      <option value="10">Oct</option><option value="11">Nov</option><option value="12">Dic</option>
    </select>
    <div class="nivel-btns">
      <button class="nbtn a-all" id="nb-all"  onclick="setNivel('')">Todos</button>
      <button class="nbtn"       id="nb-high" onclick="setNivel('high')">ğŸ”´ High</button>
      <button class="nbtn"       id="nb-med"  onclick="setNivel('medium')">ğŸŸ  Medium</button>
      <button class="nbtn"       id="nb-low"  onclick="setNivel('low')">ğŸŸ¢ Low</button>
    </div>
  </div>
</nav>

<div id="map"></div>

<div class="panel">
  <div class="search-area">
    <div class="sw">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      <input type="text" id="si" placeholder="Buscar tienda, ciudad, AM, DM..." oninput="fil()">
    </div>
    <div class="fr">
      <select id="freg"  onchange="fil()"><option value="">Todas las regiones</option><option value="r1">R1</option><option value="r10">R10</option><option value="r11">R11</option><option value="r2">R2</option><option value="r3">R3</option><option value="r4">R4</option><option value="r6">R6</option><option value="r7">R7</option><option value="r8">R8</option><option value="r9">R9</option></select>
      <select id="fzona" onchange="fil()"><option value="">Todas las zonas</option><option value="zn01">ZN01</option><option value="zn02">ZN02</option><option value="zn03">ZN03</option></select>
      <select id="fconc" onchange="fil()"><option value="">Conceptos</option><option value="ara">ARA</option><option value="agencias ara">Agencias Ara</option><option value="bdc">BDC</option><option value="cedi">CEDI</option></select>
    </div>
    <div class="fr" style="margin-top:5px">
      <select id="fciud" onchange="fil()"><option value="">Todas las ciudades</option></select>
    </div>
  </div>

  <div class="period-bar" id="periodBar">
    <span>ğŸ“…</span>
    <span id="periodTxt">Cargando...</span>
  </div>

  <div class="resumen">
    <div class="rc" id="rc-high" style="border-color:transparent" onclick="setNivel('high')">
      <div class="rc-n" style="color:#CC0000" id="cntH">-</div>
      <div class="rc-l" style="color:#CC0000">High</div>
      <div class="rc-pct" id="pctH"></div>
      <div class="rc-d" id="dltH"></div>
    </div>
    <div class="rc" id="rc-med" style="border-color:transparent" onclick="setNivel('medium')">
      <div class="rc-n" style="color:#E8920A" id="cntM">-</div>
      <div class="rc-l" style="color:#E8920A">Medium</div>
      <div class="rc-pct" id="pctM"></div>
      <div class="rc-d" id="dltM"></div>
    </div>
    <div class="rc" id="rc-low" style="border-color:transparent" onclick="setNivel('low')">
      <div class="rc-n" style="color:#27A243" id="cntL">-</div>
      <div class="rc-l" style="color:#27A243">Low</div>
      <div class="rc-pct" id="pctL"></div>
      <div class="rc-d" id="dltL"></div>
    </div>
  </div>

  <div class="tabs">
    <div class="tab active" onclick="showTab('lista')">ğŸ“ Lista</div>
    <div class="tab"        onclick="showTab('kpis')">ğŸ“Š KPIs</div>
  </div>

  <div id="tab-lista" class="lista"></div>

  <div id="tab-kpis" class="kpis-panel" style="display:none">
    <div class="sb"><h4>Score promedio por indicador</h4><div id="scoreRows"></div></div>
    <div class="sb"><h4>MÃ©tricas clave (promedio)</h4><div class="kg" id="kpiGrid"></div></div>
    <div class="sb"><h4>Top 10 mÃ¡s crÃ­ticas</h4><div id="top10"></div></div>
  </div>

  <div class="expbar">
    <button class="btn" onclick="expCSV()">â¬‡ CSV</button>
    <button class="btn" onclick="expJSON()">â¬‡ JSON</button>
    <div class="ei">Visibles: <strong id="cntVis">-</strong></div>
  </div>
</div>

<div class="legend">
  <h5>Criticidad</h5>
  <div class="lr"><div class="ld" style="background:#CC0000"></div><span class="ll">High</span><span class="lc" id="lgH">-</span></div>
  <div class="lr"><div class="ld" style="background:#E8920A"></div><span class="ll">Medium</span><span class="lc" id="lgM">-</span></div>
  <div class="lr"><div class="ld" style="background:#27A243"></div><span class="ll">Low</span><span class="lc" id="lgL">-</span></div>
  <div style="margin-top:8px;padding-top:7px;border-top:1px solid #f0f0f0;font-size:9px;color:#bbb;line-height:1.8">
    <div>â–² empeorÃ³ vs aÃ±o ant.</div>
    <div>â–¼ mejorÃ³ vs aÃ±o ant.</div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="js/data.js"></script>
<script src="js/app.js"></script>
</body>
</html>
